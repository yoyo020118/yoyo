<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Random - Admin Control</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        /* CSS Reset & Basics */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        
        body { 
            background: #111; 
            color: white; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            transition: all 0.5s ease-in-out; /* Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ… */
        }

        /* Login Screen */
        #loginScreen {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px; text-align: center;
        }

        .card {
            background: #1e1e1e; padding: 30px; border-radius: 20px;
            width: 100%; max-width: 400px; border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h1 { margin-bottom: 20px; font-size: 1.5rem; color: #007aff; }
        
        .my-id-box {
            background: #2a2a2a; padding: 10px; border-radius: 10px;
            margin: 10px 0; font-size: 1.5rem; color: #777; letter-spacing: 2px;
        }

        input {
            width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 10px;
            border: 1px solid #444; background: #111; color: white; text-align: center; font-size: 1.1rem;
        }

        button {
            width: 100%; padding: 15px; border: none; border-radius: 10px;
            font-size: 1.1rem; cursor: pointer; font-weight: bold; margin-bottom: 10px; transition: 0.2s;
        }

        .btn-connect { background: #333; color: white; }
        .btn-connect:hover { background: #444; }

        .btn-random {
            background: linear-gradient(45deg, #ff3b30, #ff9500);
            color: white; font-size: 1.3rem;
            box-shadow: 0 4px 15px rgba(255, 59, 48, 0.4);
        }

        /* Chat Screen */
        #chatScreen { display: none; flex-direction: column; height: 100%; }

        .chat-header {
            padding: 10px; background: #1e1e1e; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }

        #videoContainer {
            display: flex; flex-direction: row; height: 40vh;
            background: #000; border-bottom: 4px solid #007aff;
        }
        .video-box {
            flex: 1; position: relative; border-right: 1px solid #222;
            overflow: hidden; background: #111; display: flex; align-items: center; justify-content: center;
        }
        
        video { width: 100%; height: 100%; object-fit: cover; }

        .video-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.7); z-index: 2;
        }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #007aff;
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin-bottom: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .label {
            position: absolute; bottom: 10px; left: 10px;
            background: rgba(0,0,0,0.6); padding: 4px 10px; color: white;
            font-size: 0.9rem; border-radius: 4px; z-index: 3;
        }

        .messages-container {
            flex: 1; padding: 15px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 10px; background: #181818;
        }

        .message { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 0.95rem; }
        .msg-me { background: #007aff; align-self: flex-end; color: white; border-bottom-left-radius: 2px; }
        .msg-remote { background: #333; align-self: flex-start; color: #ddd; border-bottom-right-radius: 2px; }
        .msg-sys { align-self: center; background: none; color: #777; font-size: 0.8rem; }

        .input-area { padding: 10px; background: #1e1e1e; display: flex; gap: 10px; }
        .input-area input { margin: 0; text-align: right; }

        /* ================= ADMIN & THEMES ================= */
        
        /* Ø§Ù„Ø²Ø± Ø§Ù„Ø³Ø±ÙŠ (ØªÙ… Ø¬Ø¹Ù„Ù‡ Ù…Ø±Ø¦ÙŠØ§Ù‹ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªØ¹Ø±Ù Ù…ÙƒØ§Ù†Ù‡) */
        #secretAdminBtn {
            position: fixed; bottom: 5px; left: 5px; width: 20px; height: 20px;
            background: rgba(255, 0, 0, 0.3); /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ø®ÙÙŠÙ */
            border-radius: 50%; z-index: 9999; cursor: pointer;
        }
        #secretAdminBtn:hover { background: red; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ø¯Ù…Ù† */
        #adminModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 10000;
            flex-direction: column; align-items: center; justify-content: center;
            color: #0f0; font-family: 'Courier New', monospace;
        }
        
        .admin-panel {
            background: #050505; border: 1px solid #0f0; padding: 20px;
            width: 90%; max-width: 450px; border-radius: 5px;
            box-shadow: 0 0 20px #0f0;
        }

        .btn-admin {
            background: #002200; border: 1px solid #0f0; color: #0f0;
            padding: 10px; margin: 5px; width: 100%; font-family: monospace; 
            cursor: pointer; text-transform: uppercase; font-weight: bold;
        }
        .btn-admin:hover { background: #0f0; color: black; }
        
        .btn-kick { border-color: red; color: red; background: #220000; }
        .btn-kick:hover { background: red; color: white; }

        /* === Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø¢Ø®Ø± === */
        
        /* 1. Matrix Theme */
        body.matrix-mode { background: black !important; color: #00ff00 !important; font-family: 'Courier New', monospace !important; }
        body.matrix-mode .card, body.matrix-mode .chat-header, body.matrix-mode .input-area { background: #001100; border-color: #00ff00; }
        body.matrix-mode .messages-container { background: black; }
        body.matrix-mode .message { border: 1px solid #00ff00; background: black; color: #00ff00; }
        body.matrix-mode input { background: black; color: #00ff00; border-color: #00ff00; }

        /* 2. Light Theme */
        body.light-mode { background: #ffffff !important; color: #333333 !important; }
        body.light-mode .card, body.light-mode .chat-header, body.light-mode .input-area { background: #f0f0f0; border-color: #ccc; }
        body.light-mode .messages-container { background: #e5e5e5; }
        body.light-mode .msg-remote { background: white; color: black; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        body.light-mode input { background: white; color: black; border-color: #ccc; }
        body.light-mode h1, body.light-mode h3 { color: #007aff; }

        /* 3. Error / Kicked Screen */
        body.kicked-mode {
            background: red !important;
            display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="loginScreen">
        <div class="card">
            <h1>ğŸ“· Ø´Ø§Øª ÙÙŠØ¯ÙŠÙˆ (Ù…Ø¹ ØªØ­ÙƒÙ…)</h1>
            <button class="btn-random" onclick="startRandomSearch()">ğŸ² Ø¨Ø­Ø« Ø¹Ø´ÙˆØ§Ø¦ÙŠ (LIVE)</button>
            <p style="color:#aaa; font-size:0.9rem">Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø®Ø§Øµ:</p>
            <div class="my-id-box" id="myId">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            <input type="number" id="remoteIdInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØµØ¯ÙŠÙ‚Ùƒ">
            <button class="btn-connect" onclick="connectToPartner()">Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±</button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
    <div id="chatScreen">
        <div class="chat-header">
            <h3>Live Chat ğŸ”´</h3>
            <button class="btn-connect" style="width:auto; padding:5px 15px;" onclick="nextPartner()">â­ Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>

        <div id="videoContainer">
            <div class="video-box">
                <video id="localVideo" autoplay muted></video>
                <div class="label">Ø£Ù†Øª</div>
            </div>
            <div class="video-box">
                <div id="loadingOverlay" class="video-overlay">
                    <div class="spinner"></div>
                    <span>Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø«...</span>
                </div>
                <video id="remoteVideo" autoplay></video>
                <div class="label">Ø§Ù„Ø´Ø±ÙŠÙƒ</div>
            </div>
        </div>

        <div class="messages-container" id="messagesList"></div>

        <div class="input-area">
            <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." onkeypress="handleEnter(event)" disabled>
            <button class="btn-connect" style="width: auto; margin:0;" onclick="sendMessage()">â¤</button>
        </div>
    </div>

    <!-- ========================================= -->
    <!-- ============== Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ============= -->
    <!-- ========================================= -->
    
    <!-- Ø§Ù„Ø²Ø± Ø§Ù„Ø³Ø±ÙŠ (Ø£Ø³ÙÙ„ Ø§Ù„ÙŠØ³Ø§Ø±) -->
    <div id="secretAdminBtn" onclick="openAdminAuth()"></div>

    <div id="adminModal">
        <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="adminAuthBox" style="text-align: center;">
            <h2 style="margin-bottom:20px;">ğŸ•µï¸â€â™‚ï¸ ADMIN ACCESS</h2>
            <input type="password" id="adminPassInput" placeholder="Password (1234)" style="background:#000; color:#0f0; border:1px solid #0f0;">
            <br>
            <button class="btn-admin" onclick="checkAdminPass()">LOGIN</button>
            <button class="btn-admin" onclick="closeAdmin()" style="border-color:#555; color:#777;">CANCEL</button>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div id="adminPanelContent" class="admin-panel" style="display: none;">
            <div style="display:flex; justify-content:space-between; border-bottom:1px solid #0f0; padding-bottom:10px; margin-bottom:15px;">
                <span>âš¡ REMOTE CONTROL</span>
                <button onclick="closeAdmin()" style="background:none; border:none; color:red; cursor:pointer; font-size:1.2rem;">X</button>
            </div>

            <p style="color:#aaa; font-size:0.8rem; margin-bottom:10px;">User ID: <span id="adminTargetId" style="color:yellow">None</span></p>

            <button class="btn-admin" onclick="sendCommand('THEME_MATRIX')">ğŸ¨ Force MATRIX Theme</button>
            <button class="btn-admin" onclick="sendCommand('THEME_LIGHT')">â˜€ï¸ Force LIGHT Theme</button>
            <button class="btn-admin" onclick="sendCommand('THEME_DEFAULT')">ğŸ”„ Reset Theme</button>
            
            <div style="height:1px; background:#333; margin:15px 0;"></div>
            
            <button class="btn-admin btn-kick" onclick="sendCommand('KICK')">â˜ ï¸ KICK USER NOW</button>
        </div>
    </div>

    <script>
        const minID = 10000;
        const maxID = 99999; 
        const myNum = Math.floor(Math.random() * (maxID - minID + 1) + minID).toString();
        
        document.getElementById('myId').innerText = myNum;

        let peer;
        let conn;
        let call;
        let localStream;
        let isSearching = false;

        peer = new Peer(myNum);

        peer.on('open', id => { console.log('My ID:', id); });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ (Ø´Ø§Øª ÙˆØ£ÙˆØ§Ù…Ø±)
        peer.on('connection', connection => {
            if(conn && conn.open) return; 
            conn = connection;
            setupDataConnection(); // ØªÙØ¹ÙŠÙ„ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            updateAdminTarget(conn.peer);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        peer.on('call', incomingCall => {
            navigator.mediaDevices.getUserMedia({video: true, audio: true}).then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                
                incomingCall.answer(stream);
                call = incomingCall;
                
                call.on('stream', remoteStream => {
                    document.getElementById('remoteVideo').srcObject = remoteStream;
                });
                
                switchToChatScreen();
                stopSearchingUI();
            });
        });

        peer.on('error', err => {
            if (isSearching) setTimeout(searchRandomLogic, 1000); 
        });

        // ================= Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =================

        function startRandomSearch() {
            switchToChatScreen();
            startSearchingUI();
            navigator.mediaDevices.getUserMedia({video: true, audio: true}).then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                isSearching = true;
                searchRandomLogic();
            }).catch(e => { alert("Camera access needed"); location.reload(); });
        }

        function searchRandomLogic() {
            if (!isSearching) return;
            const randomTarget = Math.floor(Math.random() * (maxID - minID + 1) + minID).toString();
            if (randomTarget === myNum) return searchRandomLogic();

            let tempConn = peer.connect(randomTarget);
            tempConn.on('open', () => {
                isSearching = false;
                conn = tempConn;
                setupDataConnection(); // ØªÙØ¹ÙŠÙ„ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                updateAdminTarget(conn.peer);

                call = peer.call(randomTarget, localStream);
                call.on('stream', rs => document.getElementById('remoteVideo').srcObject = rs);
                stopSearchingUI();
            });
        }

        function connectToPartner() {
            const remoteId = document.getElementById('remoteIdInput').value;
            if(!remoteId) return alert("Enter ID");
            
            navigator.mediaDevices.getUserMedia({video: true, audio: true}).then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                
                conn = peer.connect(remoteId);
                conn.on('open', () => {
                    setupDataConnection();
                    updateAdminTarget(remoteId);
                    
                    call = peer.call(remoteId, stream);
                    call.on('stream', rs => document.getElementById('remoteVideo').srcObject = rs);
                    switchToChatScreen();
                    stopSearchingUI();
                });
            });
        }

        // ====================================================
        // ğŸ”¥ğŸ”¥ Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¨Ø¶: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø± ğŸ”¥ğŸ”¥
        // ====================================================

        function setupDataConnection() {
            conn.on('data', data => {
                console.log("Received data:", data); // Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª "Ø£Ù…Ø± Ø£Ø¯Ù…Ù†"
                // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ Ù‡Ùˆ: $$CMD:
                if (typeof data === 'string' && data.startsWith("$$CMD:")) {
                    const command = data.split(":")[1]; // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ù…Ø±
                    executeRemoteCommand(command);
                } 
                else {
                    // Ø±Ø³Ø§Ù„Ø© Ø´Ø§Øª Ø¹Ø§Ø¯ÙŠØ©
                    addMessage(data, 'remote');
                }
            });

            conn.on('close', () => {
                conn = null;
                addSystemMsg("ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„.");
            });
        }

        // ğŸŸ¢ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø­ÙŠØ© (Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„)
        function executeRemoteCommand(cmd) {
            console.log("EXECUTING COMMAND:", cmd);
            
            if (cmd === 'THEME_MATRIX') {
                document.body.className = 'matrix-mode';
                addSystemMsg("âš ï¸ SYSTEM: Matrix Protocol Initiated...");
            }
            else if (cmd === 'THEME_LIGHT') {
                document.body.className = 'light-mode';
                addSystemMsg("âš ï¸ SYSTEM: Flashbang Initiated...");
            }
            else if (cmd === 'THEME_DEFAULT') {
                document.body.className = '';
                addSystemMsg("â„¹ï¸ SYSTEM: Theme Reset.");
            }
            else if (cmd === 'KICK') {
                // Ø§Ù„Ø·Ø±Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                document.body.innerHTML = '<h1 style="color:white; font-size:3rem; text-align:center; margin-top:20%">â›”<br>YOU HAVE BEEN KICKED<br>BY ADMIN</h1>';
                document.body.style.background = 'red';
                // Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
                if(conn) conn.close();
                if(call) call.close();
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆÙ†ØµÙ
                setTimeout(() => location.reload(), 2000);
            }
        }

        // ğŸ”´ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† (Ø§Ù„Ù…Ø±Ø³Ù„)
        function sendCommand(type) {
            if(conn && conn.open) {
                // Ù†Ø±Ø³Ù„ Ø§Ù„Ù†Øµ Ù…Ø¹ Ø§Ù„Ø¨Ø§Ø¯Ø¦Ø© Ø§Ù„Ø³Ø±ÙŠØ©
                conn.send("$$CMD:" + type);
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ£Ø«ÙŠØ± Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙŠØ¶Ø§Ù‹ Ù„ØªØ±Ù‰ Ù…Ø§ ÙŠØ­Ø¯Ø«
                if (type !== 'KICK') {
                    executeRemoteCommand(type);
                } else {
                    addSystemMsg("ğŸš« SENDING KICK COMMAND...");
                    setTimeout(() => {
                        conn.close();
                        location.reload();
                    }, 1000);
                }
            } else {
                alert("You are not connected to anyone!");
            }
        }

        // ====================================================

        function sendMessage() {
            const input = document.getElementById('msgInput');
            const msg = input.value;
            if(msg && conn && conn.open) {
                conn.send(msg); // Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø§Ø¯ÙŠ Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø¯Ø¦Ø©
                addMessage(msg, 'me');
                input.value = '';
            }
        }

        function openAdminAuth() {
            document.getElementById('adminModal').style.display = 'flex';
            document.getElementById('adminAuthBox').style.display = 'block';
            document.getElementById('adminPanelContent').style.display = 'none';
        }

        function closeAdmin() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassInput').value = '';
        }

        function checkAdminPass() {
            if(document.getElementById('adminPassInput').value === "1234") {
                document.getElementById('adminAuthBox').style.display = 'none';
                document.getElementById('adminPanelContent').style.display = 'block';
            } else {
                alert("Ø®Ø·Ø£ ÙÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
            }
        }
        
        function updateAdminTarget(id) {
            document.getElementById('adminTargetId').innerText = id;
        }

        function switchToChatScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('chatScreen').style.display = 'flex';
        }

        function startSearchingUI() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('remoteVideo').srcObject = null;
            document.getElementById('msgInput').disabled = true;
        }

        function stopSearchingUI() {
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('msgInput').disabled = false;
        }

        function nextPartner() {
            if(conn) conn.close();
            if(call) call.close();
            conn = null;
            call = null;
            document.getElementById('messagesList').innerHTML = '';
            document.body.className = ''; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø«ÙŠÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ø¯ÙŠØ¯
            isSearching = true;
            startSearchingUI();
            searchRandomLogic();
        }

        function addMessage(msg, type) {
            const container = document.getElementById('messagesList');
            const div = document.createElement('div');
            div.className = 'message ' + (type === 'me' ? 'msg-me' : 'msg-remote');
            div.innerText = msg;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function addSystemMsg(txt) {
            const container = document.getElementById('messagesList');
            const div = document.createElement('div');
            div.className = 'message msg-sys';
            div.innerText = txt;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

    </script>
</body>
</html>
